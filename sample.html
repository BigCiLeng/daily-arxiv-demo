<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>arXiv Daily Digest</title>
  <style>
    :root {
      --bg-surface: #ffffff;
      --bg-app: #f4f6fb;
      --text-primary: #1f2933;
      --text-secondary: #4b5563;
      --brand: #2563eb;
      --brand-soft: rgba(37, 99, 235, 0.12);
      --border: #e2e8f0;
      --danger: #dc2626;
    }
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      margin: 0;
      background: var(--bg-app);
      color: var(--text-primary);
      line-height: 1.6;
      scroll-behavior: smooth;
    }
    header {
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.82), #0f172a);
      color: white;
      padding: 36px 0 48px;
      box-shadow: 0 30px 60px rgba(15, 23, 42, 0.35);
    }
    header .inner {
      max-width: 1320px;
      margin: 0 auto;
      padding: 0 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .page-title {
      font-size: clamp(2.2rem, 3vw, 2.8rem);
      font-weight: 700;
      margin: 0;
    }
    .page-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      font-size: 0.95rem;
      color: rgba(248, 250, 252, 0.85);
    }
    .page-meta span::before {
      content: "â€¢";
      margin: 0 8px 0 4px;
      opacity: 0.5;
    }
    .page-meta span:first-child::before {
      content: "";
      margin: 0;
    }
    .source-switcher {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .source-button {
      appearance: none;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.2);
      color: white;
      padding: 6px 16px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }
    .source-button:hover,
    .source-button:focus {
      background: rgba(37, 99, 235, 0.35);
      border-color: rgba(96, 165, 250, 0.75);
      outline: none;
    }
    .source-button.is-active {
      background: white;
      color: var(--brand);
      border-color: transparent;
      box-shadow: 0 6px 18px rgba(14, 116, 244, 0.35);
      transform: translateY(-1px);
    }
    .display-mode {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 12px;
    }
    .display-mode__label {
      font-size: 0.9rem;
      font-weight: 600;
      color: rgba(248, 250, 252, 0.85);
      margin-right: 4px;
    }
    .display-mode__button {
      appearance: none;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.2);
      color: white;
      padding: 6px 14px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }
    .display-mode__button:hover,
    .display-mode__button:focus {
      background: rgba(37, 99, 235, 0.35);
      border-color: rgba(96, 165, 250, 0.75);
      outline: none;
    }
    .display-mode__button.is-active {
      background: white;
      color: var(--brand);
      border-color: transparent;
      box-shadow: 0 6px 18px rgba(14, 116, 244, 0.35);
      transform: translateY(-1px);
    }
    .layout {
      display: flex;
      gap: 32px;
      align-items: flex-start;
      max-width: 1320px;
      margin: -32px auto 48px;
      padding: 0 32px 64px;
    }
    .sidebar {
      position: sticky;
      top: 24px;
      flex: 0 0 300px;
      background: var(--bg-surface);
      border-radius: 20px;
      padding: 24px 20px;
      box-shadow: 0 24px 48px rgba(15, 23, 42, 0.12);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 18px;
      height: fit-content;
      max-height: calc(100vh - 48px);
    }
    .preferences-card {
      background: linear-gradient(140deg, rgba(37, 99, 235, 0.08), rgba(2, 132, 199, 0.1));
      border-radius: 16px;
      padding: 18px 20px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .preferences-card h2 {
      margin: 0;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
    }
    .preferences-view {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .preferences-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .preferences-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
    }
    .preferences-empty {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    .preferences-edit {
      align-self: flex-start;
      padding: 6px 16px;
      border-radius: 10px;
      border: none;
      background: var(--brand);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .preferences-edit:hover,
    .preferences-edit:focus {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.25);
      outline: none;
    }
    .preferences-card textarea {
      width: 100%;
      min-height: 70px;
      resize: vertical;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 10px 12px;
      font-size: 0.9rem;
      font-family: inherit;
      background: rgba(255, 255, 255, 0.82);
      color: var(--text-primary);
    }
    .preferences-actions {
      display: flex;
      gap: 10px;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .preferences-actions button {
      flex: 1 1 0;
      padding: 8px 12px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .preferences-actions button[type="submit"] {
      background: var(--brand);
      color: white;
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.32);
    }
    .preferences-actions button[type="submit"]:hover,
    .preferences-actions button[type="submit"]:focus {
      transform: translateY(-1px);
      outline: none;
    }
    .preferences-actions button.preferences-cancel,
    .preferences-actions button.preferences-reset {
      background: rgba(15, 23, 42, 0.08);
      color: var(--text-secondary);
    }
    .preferences-actions button.preferences-cancel:hover,
    .preferences-actions button.preferences-cancel:focus,
    .preferences-actions button.preferences-reset:hover,
    .preferences-actions button.preferences-reset:focus {
      background: rgba(15, 23, 42, 0.15);
      outline: none;
    }
    .preferences-status {
      min-height: 20px;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    .nav-title {
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    .sidebar nav {
      overflow-y: auto;
      padding-right: 6px;
      flex: 1;
    }
    .sidebar nav::-webkit-scrollbar {
      width: 6px;
    }
    .sidebar nav::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 999px;
    }
    .nav-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .nav-list.nav-level-2 {
      padding-left: 18px;
      gap: 4px;
    }
    .nav-list.nav-level-3 {
      padding-left: 18px;
      gap: 4px;
    }
    .nav-item a {
      display: block;
      padding: 8px 10px;
      border-radius: 10px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .nav-item a:hover,
    .nav-item a:focus {
      background: var(--brand-soft);
      color: var(--brand);
      outline: none;
    }
    .nav-item a.is-active {
      background: var(--brand);
      color: white;
    }
    .content {
      flex: 1;
      min-width: 0;
    }
    .content-section {
      background: var(--bg-surface);
      border-radius: 24px;
      padding: 28px 32px;
      box-shadow: 0 24px 48px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--border);
      margin-bottom: 36px;
      transition: box-shadow 0.25s ease, transform 0.25s ease;
      position: relative;
    }
    .content-section.is-hidden {
      display: none;
    }
    .content-section:not(.is-collapsed):hover {
      box-shadow: 0 28px 60px rgba(15, 23, 42, 0.12);
      transform: translateY(-2px);
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .section-header h2 {
      margin: 0;
      font-size: 1.6rem;
    }
    .section-summary {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text-secondary);
    }
    .section-toggle {
      appearance: none;
      border: none;
      background: var(--brand-soft);
      color: var(--brand);
      border-radius: 999px;
      font-weight: 600;
      padding: 6px 18px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }
    .section-toggle:hover,
    .section-toggle:focus {
      background: rgba(37, 99, 235, 0.2);
      outline: none;
      transform: translateY(-1px);
    }
    .section-body {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .content-section.is-collapsed .section-body {
      display: none;
    }
    .stats-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }
    .stat-card {
      background: linear-gradient(145deg, rgba(37, 99, 235, 0.08), rgba(2, 132, 199, 0.08));
      border-radius: 18px;
      padding: 20px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .stat-card h3 {
      font-size: 1rem;
      margin: 0;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .stat-card p {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .stat-card ul {
      margin: 0;
      padding-left: 18px;
      color: var(--text-secondary);
      font-size: 0.95rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .paper {
      background: var(--bg-surface);
      border-radius: 18px;
      padding: 22px 24px;
      border: 1px solid var(--border);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    }
    .paper + .paper {
      margin-top: 18px;
    }
    .paper h3 {
      margin: 0 0 12px 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .paper h3 .quick-view-button {
      flex: 0 0 auto;
    }
    .paper h3 a {
      color: inherit;
      text-decoration: none;
    }
    .paper h3 a:hover {
      color: var(--brand);
    }
    .paper .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    .paper .meta .id {
      font-weight: 600;
      color: var(--brand);
    }
    .paper .subjects {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    .paper .abstract {
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    .paper .links {
      display: flex;
      gap: 16px;
      font-weight: 600;
      flex-wrap: wrap;
      margin: 0;
    }
    .paper .links a {
      color: var(--brand);
      text-decoration: none;
    }
    .paper .links a:hover {
      text-decoration: underline;
    }
    .paper .link-button {
      appearance: none;
      border: 1px solid rgba(37, 99, 235, 0.4);
      background: rgba(37, 99, 235, 0.08);
      color: var(--brand);
      padding: 6px 14px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }
    .paper .link-button:hover,
    .paper .link-button:focus {
      background: rgba(37, 99, 235, 0.18);
      border-color: rgba(37, 99, 235, 0.55);
      outline: none;
      transform: translateY(-1px);
    }
    body.display-mode-title .paper:not(.paper--expanded) .quick-view-button,
    body.display-mode-authors .paper:not(.paper--expanded) .quick-view-button {
      padding: 4px 10px;
      font-size: 0.85rem;
    }
    .paper:hover {
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 12px 24px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
    }
    .paper.paper--expanded {
      border-color: var(--brand);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 16px 32px rgba(37, 99, 235, 0.18);
    }
    body.display-mode-title .paper:not(.paper--expanded) .meta,
    body.display-mode-title .paper:not(.paper--expanded) .subjects,
    body.display-mode-title .paper:not(.paper--expanded) .abstract {
      display: none;
    }
    body.display-mode-authors .paper:not(.paper--expanded) .meta .id {
      display: none;
    }
    body.display-mode-authors .paper:not(.paper--expanded) .subjects,
    body.display-mode-authors .paper:not(.paper--expanded) .abstract {
      display: none;
    }
    body.display-mode-title .paper:not(.paper--expanded),
    body.display-mode-authors .paper:not(.paper--expanded) {
      padding: 12px 16px;
      border-radius: 12px;
      border-color: rgba(148, 163, 184, 0.6);
      box-shadow: none;
      background: rgba(255, 255, 255, 0.92);
      display: grid;
      grid-template-columns: 1fr;
      row-gap: 4px;
    }
    body.display-mode-title .paper:not(.paper--expanded) h3,
    body.display-mode-authors .paper:not(.paper--expanded) h3 {
      margin: 0;
      font-size: 1rem;
      line-height: 1.3;
    }
    body.display-mode-title .paper:not(.paper--expanded) h3 a,
    body.display-mode-authors .paper:not(.paper--expanded) h3 a {
      display: inline-block;
      max-width: 100%;
    }
    body.display-mode-title .paper:not(.paper--expanded) .meta {
      margin-bottom: 0;
    }
    body.display-mode-authors .paper:not(.paper--expanded) .meta {
      margin-bottom: 0;
      gap: 6px;
      font-size: 0.85rem;
      line-height: 1.3;
    }
    body.display-mode-authors .paper:not(.paper--expanded) .authors {
      font-weight: 500;
      color: var(--text-secondary);
    }
    body.display-mode-title .paper:not(.paper--expanded) + .paper:not(.paper--expanded),
    body.display-mode-authors .paper:not(.paper--expanded) + .paper:not(.paper--expanded) {
      margin-top: 8px;
    }
    body.display-mode-title .paper:not(.paper--expanded) .links,
    body.display-mode-authors .paper:not(.paper--expanded) .links {
      gap: 8px;
    }
    body.display-mode-title .paper:not(.paper--expanded) .links a,
    body.display-mode-authors .paper:not(.paper--expanded) .links a {
      display: none;
    }
    body.display-mode-title .paper:not(.paper--expanded) .links .link-button,
    body.display-mode-authors .paper:not(.paper--expanded) .links .link-button {
      padding: 4px 10px;
      font-size: 0.85rem;
    }
    body.modal-open {
      overflow: hidden;
    }
    .abstract-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1200;
    }
    .abstract-modal.is-open {
      display: flex;
    }
    .abstract-modal__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
    }
    .abstract-modal__dialog {
      position: relative;
      width: min(960px, 92vw);
      height: min(80vh, 720px);
      background: white;
      border-radius: 18px;
      box-shadow: 0 40px 80px rgba(15, 23, 42, 0.35);
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 1;
    }
    .abstract-modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(226, 232, 240, 0.8);
      gap: 12px;
    }
    .abstract-modal__title {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      line-height: 1.4;
      color: var(--text-primary);
    }
    .abstract-modal__close {
      appearance: none;
      border: none;
      background: rgba(15, 23, 42, 0.04);
      color: var(--text-secondary);
      padding: 6px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .abstract-modal__close:hover,
    .abstract-modal__close:focus {
      background: rgba(37, 99, 235, 0.15);
      color: var(--brand);
      outline: none;
    }
    .abstract-modal__body {
      flex: 1;
      padding: 20px 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      overflow-y: auto;
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.9), rgba(241, 245, 249, 0.6));
    }
    .abstract-modal__meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.92rem;
      color: var(--text-secondary);
    }
    .abstract-modal__id {
      font-weight: 600;
      color: var(--brand);
    }
    .abstract-modal__authors {
      flex: 1 1 100%;
    }
    .abstract-modal__subjects {
      flex: 1 1 100%;
    }
    .abstract-modal__abstract {
      font-size: 0.95rem;
      color: var(--text-primary);
      line-height: 1.65;
      white-space: pre-line;
    }
    .abstract-modal__actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: auto;
    }
    .abstract-modal__actions a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 999px;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }
    .abstract-modal__actions a.primary {
      background: var(--brand);
      color: white;
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.28);
    }
    .abstract-modal__actions a.primary:hover,
    .abstract-modal__actions a.primary:focus {
      background: #1d4ed8;
      transform: translateY(-1px);
      outline: none;
    }
    .abstract-modal__actions a.secondary {
      border: 1px solid rgba(37, 99, 235, 0.35);
      color: var(--brand);
      background: rgba(37, 99, 235, 0.1);
    }
    .abstract-modal__actions a.secondary:hover,
    .abstract-modal__actions a.secondary:focus {
      background: rgba(37, 99, 235, 0.18);
      outline: none;
      transform: translateY(-1px);
    }
    .empty-state {
      background: var(--bg-surface);
      border: 1px dashed var(--border);
      border-radius: 14px;
      padding: 18px 20px;
      color: var(--text-secondary);
    }
    .chip-set {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 2px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 999px;
      background: var(--brand-soft);
      color: var(--brand);
      font-size: 0.85rem;
      font-weight: 600;
    }
    .watcher-summary {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.93rem;
      color: var(--text-secondary);
    }
    .subject-grid {
      display: grid;
      gap: 28px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }
    .category-block {
      padding: 12px 0 4px;
      border-top: 1px solid rgba(148, 163, 184, 0.3);
    }
    .category-block:first-of-type {
      border-top: none;
      padding-top: 0;
    }
    .category-block__header {
      display: flex;
      align-items: baseline;
      gap: 12px;
      margin-bottom: 18px;
    }
    .category-block__header h3 {
      margin: 0;
      font-size: 1.35rem;
    }
    .subject-group {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 18px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(241, 245, 249, 0.6));
    }
    .subject-group__header {
      display: flex;
      align-items: baseline;
      gap: 12px;
    }
    .subject-group__header h4 {
      margin: 0;
      font-size: 1.05rem;
    }
    .count-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 10px;
      border-radius: 999px;
      background: var(--brand-soft);
      color: var(--brand);
      font-size: 0.85rem;
      font-weight: 600;
    }
    .skip-link {
      position: absolute;
      top: -48px;
      left: 16px;
      background: var(--brand);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: top 0.2s ease;
      z-index: 10;
    }
    .skip-link:focus {
      top: 16px;
    }
    footer {
      background: #0f172a;
      color: rgba(248, 250, 252, 0.9);
      padding: 24px 32px;
      font-size: 0.9rem;
      text-align: center;
    }
    footer a {
      color: #93c5fd;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
    .noscript-warning {
      max-width: 960px;
      margin: 32px auto;
      padding: 20px;
      background: rgba(254, 240, 138, 0.35);
      border: 1px solid rgba(250, 204, 21, 0.6);
      border-radius: 12px;
      color: #92400e;
      font-size: 0.95rem;
    }
    @media (max-width: 960px) {
      .layout {
        flex-direction: column;
        padding: 0 20px 40px;
        gap: 24px;
      }
      .sidebar {
        position: static;
        width: 100%;
        max-height: none;
      }
      .content {
        width: 100%;
      }
      .nav-list {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .nav-list.nav-level-2,
      .nav-list.nav-level-3 {
        width: 100%;
        padding-left: 0;
      }
      .nav-list.nav-level-2 .nav-item a,
      .nav-list.nav-level-3 .nav-item a {
        padding-left: 14px;
      }
    }
    @media (max-width: 640px) {
      header .inner {
        padding: 0 20px;
      }
      .content-section {
        padding: 22px;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .subject-grid {
        grid-template-columns: 1fr;
      }
      .layout {
        margin-top: -24px;
      }
      .preferences-actions {
        flex-direction: column;
      }
      .preferences-actions button {
        flex: 1 1 auto;
      }
      .source-switcher {
        justify-content: flex-start;
      }
      .display-mode {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body class="display-mode-authors">
  <a class="skip-link" href="#main-content">Skip to content</a>
  <header>
    <div class="inner">
      <h1 class="page-title">arXiv cs Daily Digest</h1>
      <div class="page-meta">
        <span id="meta-source">Source: Computer Vision (cs.CV)</span>
        <span id="meta-date">Date: 2024-07-01</span>
        <span id="meta-generated">Generated at: 2024-07-01 12:00 UTC</span>
        <span id="meta-total">Total papers: 1</span>
      </div>
      <div class="source-switcher" id="source-switcher" role="group" aria-label="Select arXiv category"></div>
    </div>
  </header>
  <noscript>
    <div class="noscript-warning">This dashboard requires JavaScript to filter sources and update preferences. Please enable JavaScript in your browser.</div>
  </noscript>
  <div class="layout">
    <aside class="sidebar">
      <div class="preferences-card">
        <h2>Tracking</h2>
        <div id="preferences-view" class="preferences-view">
          <div class="preferences-group">
            <span class="preferences-label">Favorite authors</span>
            <div class="chip-set" id="favorite-authors-view"></div>
          </div>
          <div class="preferences-group">
            <span class="preferences-label">Watched keywords</span>
            <div class="chip-set" id="keywords-view"></div>
          </div>
          <button type="button" id="edit-preferences" class="preferences-edit">Edit</button>
          <p class="preferences-status" id="preferences-status-view" role="status" aria-live="polite"></p>
        </div>
        <form id="preferences-form" hidden>
          <label for="favorite-authors-input" class="preferences-label">Favorite authors</label>
          <textarea id="favorite-authors-input" placeholder="One per line or comma separated">Test Author</textarea>
          <label for="keywords-input" class="preferences-label">Watched keywords</label>
          <textarea id="keywords-input" placeholder="One per line or comma separated">Vision</textarea>
          <div class="preferences-actions">
            <button type="submit">Save</button>
            <button type="button" id="cancel-preferences" class="preferences-cancel">Cancel</button>
            <button type="button" id="reset-preferences" class="preferences-reset">Reset</button>
          </div>
          <p class="preferences-status" id="preferences-status" role="status" aria-live="polite"></p>
        </form>
      </div>
      <div class="nav-title">On this page</div>
      <nav aria-label="Section navigation"></nav>
    </aside>
    <main id="main-content" class="content">
      <section id="overview" class="content-section is-collapsed is-hidden">
        <div class="section-header">
          <h2>All Papers</h2>
          <p class="section-summary" id="overview-summary"></p>
        </div>
        <div class="section-body" id="overview-body"></div>
      </section>
      <section id="stats" class="content-section" data-collapsible="true">
        <div class="section-header">
          <h2>Statistics</h2>
          <button type="button" class="section-toggle" data-target="stats" aria-expanded="true">Hide section</button>
        </div>
        <div class="section-body" id="stats-body"></div>
      </section>
      <section id="favorite" class="content-section is-collapsed is-hidden" data-collapsible="true">
        <div class="section-header">
          <h2>Favorite Authors</h2>
          <button type="button" class="section-toggle" data-target="favorite" aria-expanded="false">Show section</button>
        </div>
        <div class="section-body" id="favorite-body"></div>
      </section>
      <section id="keyword" class="content-section is-collapsed is-hidden" data-collapsible="true">
        <div class="section-header">
          <h2>Watched Keywords</h2>
          <button type="button" class="section-toggle" data-target="keyword" aria-expanded="false">Show section</button>
        </div>
        <div class="section-body" id="keywords-body"></div>
      </section>
      <section id="categories" class="content-section is-collapsed is-hidden" data-collapsible="true">
        <div class="section-header">
          <h2>Browse by Category</h2>
          <button type="button" class="section-toggle" data-target="categories" aria-expanded="false">Show section</button>
        </div>
        <div class="section-body" id="categories-body"></div>
      </section>
    </main>
  </div>
  <div class="abstract-modal" id="abstract-modal" aria-hidden="true">
    <div class="abstract-modal__backdrop" data-modal-dismiss="true"></div>
    <div class="abstract-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="abstract-modal-title">
      <div class="abstract-modal__header">
        <h2 class="abstract-modal__title" id="abstract-modal-title">Preview abstract</h2>
        <button type="button" class="abstract-modal__close" id="abstract-modal-close">Close</button>
      </div>
      <div class="abstract-modal__body" id="abstract-modal-body">
        <div class="abstract-modal__meta">
          <span class="abstract-modal__id" id="abstract-modal-id"></span>
          <span class="abstract-modal__authors" id="abstract-modal-authors"></span>
          <span class="abstract-modal__subjects" id="abstract-modal-subjects"></span>
        </div>
        <div class="abstract-modal__abstract" id="abstract-modal-abstract"></div>
        <div class="abstract-modal__actions">
          <a href="#" target="_blank" rel="noopener" class="primary" id="abstract-modal-original">Open on arXiv</a>
          <a href="#" target="_blank" rel="noopener" class="secondary" id="abstract-modal-pdf" hidden>Download PDF</a>
        </div>
      </div>
    </div>
  </div>
  <footer>
    Source: <a id="footer-source" href="https://arxiv.org/list/cs.CV/recent?skip=0&amp;show=2000" target="_blank" rel="noopener">Computer Vision (cs.CV)</a>
  </footer>
  <script type="application/json" id="digest-data">{"generated_at": "2024-07-01 12:00 UTC", "default_source": "cs.CV", "preferences": {"favorite_authors": ["Test Author"], "keywords": ["Vision"]}, "sources": {"cs.CV": {"label": "Computer Vision (cs.CV)", "url": "https://arxiv.org/list/cs.CV/recent?skip=0&show=2000", "date": "2024-07-01", "stats": {"total": 1, "unique_authors": 1, "total_authorships": 1, "average_authors": 1.0, "top_authors": [["Test Author", 1]], "top_phrases": [["test phrase", 1]], "section_counts": {"New submissions": 1}}, "articles": [{"arxiv_id": "1234.5678", "title": "Test Paper", "abs_url": "https://arxiv.org/abs/1234.5678", "pdf_url": "https://arxiv.org/pdf/1234.5678", "authors": ["Test Author"], "abstract": "Autoregressive video diffusion models are capable of long rollouts that are stable and consistent with history, but they are unable to guide the current generation with conditioning from the future. In camera-guided video generation with a predefined camera trajectory, this limitation leads to collisions with the generated scene, after which autoregression quickly collapses. To address this, we propose Generative View Stitching (GVS), which samples the entire sequence in parallel such that the generated scene is faithful to every part of the predefined camera trajectory. Our main contribution is a sampling algorithm that extends prior work on diffusion stitching for robot planning to video generation. While such stitching methods usually require a specially trained model, GVS is compatible with any off-the-shelf video model trained with Diffusion Forcing, a prevalent sequence diffusion framework that we show already provides the affordances necessary for stitching. We then introduce Omni Guidance, a technique that enhances the temporal consistency in stitching by conditioning on both the past and future, and that enables our proposed loop-closing mechanism for delivering long-range coherence. Overall, GVS achieves camera-guided video generation that is stable, collision-free, frame-to-frame consistent, and closes loops for a variety of predefined camera paths, including Oscar ReutersvÃ¤rd's Impossible Staircase. Results are best viewed as videos at this https URL.", "primary_subject": "Computer Vision", "subjects": ["cs.CV"], "section_type": "New submissions", "submission_date": "2024-06-30"}]}, "cs.RO": {"label": "Robotics (cs.RO)", "url": "https://arxiv.org/list/cs.RO/recent?skip=0&show=2000", "date": "2024-07-01", "stats": {"total": 0, "unique_authors": 0, "total_authorships": 0, "average_authors": 0.0, "top_authors": [], "top_phrases": [], "section_counts": {}}, "articles": []}}}</script>
  <script>
(() => {
  const RAW_DATA = JSON.parse(document.getElementById('digest-data').textContent);
  const SOURCE_STORAGE_KEY = 'arxivDigestSource';
  const PREF_STORAGE_KEY = 'arxivDigestPreferences';
  const DISPLAY_MODE_STORAGE_KEY = 'arxivDigestDisplayMode';
  const DISPLAY_MODE_CLASSES = {
    title: 'display-mode-title',
    authors: 'display-mode-authors',
    full: 'display-mode-full',
  };
  const DISPLAY_MODE_OPTIONS = [
    { key: 'title', label: 'Title only' },
    { key: 'authors', label: 'Title & authors' },
    { key: 'full', label: 'Full details' },
  ];
  let modalHandlersBound = false;

  const SOURCE_KEYS = Object.keys(RAW_DATA.sources || {});
  if (!SOURCE_KEYS.length) {
    return;
  }
  const generatedAt = RAW_DATA.generated_at || '';
  const initialPreferences = normalizePreferences(RAW_DATA.preferences || {});

  const state = {
    source: loadStoredSource(),
    preferences: loadStoredPreferences(),
    isEditingPreferences: false,
    activeSection: 'stats',
    displayMode: loadStoredDisplayMode() || 'authors',
    expandedArticles: new Set(),
    lastModalTrigger: null,
  };

  if (!RAW_DATA.sources[state.source]) {
    state.source = RAW_DATA.default_source && RAW_DATA.sources[RAW_DATA.default_source]
      ? RAW_DATA.default_source
      : SOURCE_KEYS[0];
  }

  const elements = {
    sourceSwitcher: document.getElementById('source-switcher'),
    displayModeControls: document.getElementById('display-mode-controls'),
    nav: document.querySelector('.sidebar nav'),
    preferencesView: document.getElementById('preferences-view'),
    preferencesForm: document.getElementById('preferences-form'),
    favoriteAuthorsView: document.getElementById('favorite-authors-view'),
    keywordsView: document.getElementById('keywords-view'),
    favoritesInput: document.getElementById('favorite-authors-input'),
    keywordsInput: document.getElementById('keywords-input'),
    editPreferences: document.getElementById('edit-preferences'),
    cancelPreferences: document.getElementById('cancel-preferences'),
    resetPreferences: document.getElementById('reset-preferences'),
    preferencesStatusView: document.getElementById('preferences-status-view'),
    preferencesStatus: document.getElementById('preferences-status'),
    overviewSummary: document.getElementById('overview-summary'),
    overviewBody: document.getElementById('overview-body'),
    statsBody: document.getElementById('stats-body'),
    favoritesBody: document.getElementById('favorite-body'),
    keywordsBody: document.getElementById('keywords-body'),
    categoriesBody: document.getElementById('categories-body'),
    headerSource: document.getElementById('meta-source'),
    headerDate: document.getElementById('meta-date'),
    headerGenerated: document.getElementById('meta-generated'),
    headerTotal: document.getElementById('meta-total'),
    footerSource: document.getElementById('footer-source'),
    abstractModal: document.getElementById('abstract-modal'),
    abstractModalClose: document.getElementById('abstract-modal-close'),
    abstractModalTitle: document.getElementById('abstract-modal-title'),
    abstractModalBody: document.getElementById('abstract-modal-body'),
    abstractModalId: document.getElementById('abstract-modal-id'),
    abstractModalAuthors: document.getElementById('abstract-modal-authors'),
    abstractModalSubjects: document.getElementById('abstract-modal-subjects'),
    abstractModalAbstract: document.getElementById('abstract-modal-abstract'),
    abstractModalOriginal: document.getElementById('abstract-modal-original'),
    abstractModalPdf: document.getElementById('abstract-modal-pdf'),
  };

  document.addEventListener('click', handleQuickViewClick);
  document.addEventListener('click', handlePaperClick);
  document.addEventListener('keydown', handlePaperKeydown);
  document.addEventListener('keydown', handleGlobalKeydown);

  if (elements.editPreferences) {
    elements.editPreferences.addEventListener('click', () => {
      state.isEditingPreferences = true;
      setStatus('');
      renderPreferencesPanel();
      if (elements.favoritesInput) {
        elements.favoritesInput.focus();
      }
    });
  }

  if (elements.cancelPreferences) {
    elements.cancelPreferences.addEventListener('click', () => {
      state.isEditingPreferences = false;
      setStatus('');
      renderPreferencesPanel();
    });
  }

  if (elements.preferencesForm) {
    elements.preferencesForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const nextPrefs = normalizePreferences({
        favorite_authors: elements.favoritesInput ? elements.favoritesInput.value : '',
        keywords: elements.keywordsInput ? elements.keywordsInput.value : '',
      });
      state.preferences = nextPrefs;
      state.isEditingPreferences = false;
      savePreferences(nextPrefs);
      renderAll({ resetActiveSection: false });
      setStatus('Preferences saved.');
    });
  }

  if (elements.resetPreferences) {
    elements.resetPreferences.addEventListener('click', () => {
      state.preferences = normalizePreferences(initialPreferences);
      state.isEditingPreferences = true;
      savePreferences(state.preferences);
      renderAll({ resetActiveSection: false });
      setStatus('Preferences reset to defaults.');
    });
  }

  renderAll({ resetActiveSection: true });

  function renderAll(options = {}) {
    if (options.resetActiveSection) {
      state.activeSection = 'stats';
    }
    renderSourceButtons();
    renderDisplayModeControls();
    renderPreferencesPanel();

    const sourceData = RAW_DATA.sources[state.source];
    if (!sourceData) {
      return;
    }

    const articles = sourceData.articles || [];
    pruneExpandedArticles(articles);
    applyDisplayModeClass();
    updateHeader(sourceData);
    const overviewCount = renderOverview(sourceData, articles);
    renderStats(sourceData);
    const favoriteCount = renderFavorites(sourceData, articles);
    const keywordCount = renderKeywords(sourceData, articles);
    const categoriesNavItems = renderCategories(sourceData, articles);
    renderNavigation(sourceData, overviewCount, favoriteCount, keywordCount, categoriesNavItems);
    updateFooter(sourceData);
    attachSectionHandlers();
    attachModalHandlers();
    setActiveSection(state.activeSection);
    updatePaperAria();
  }

  function renderSourceButtons() {
    const container = elements.sourceSwitcher;
    if (!container) return;
    container.innerHTML = SOURCE_KEYS.map((key) => {
      const label = RAW_DATA.sources[key].label || key;
      const active = key === state.source ? 'is-active' : '';
      return `<button type="button" class="source-button ${active}" data-source="${key}">${escapeHtml(label)}</button>`;
    }).join('');
    Array.from(container.querySelectorAll('button[data-source]')).forEach((button) => {
      button.addEventListener('click', () => {
        const nextSource = button.getAttribute('data-source');
        if (!nextSource || nextSource === state.source || !RAW_DATA.sources[nextSource]) return;
        state.source = nextSource;
        saveSource(nextSource);
        setStatus('');
        state.activeSection = 'stats';
        state.expandedArticles.clear();
        renderAll({ resetActiveSection: true });
      });
    });
  }

  function renderDisplayModeControls() {
    const container = elements.displayModeControls;
    if (!container) return;
    const label = `<span class="display-mode__label">Paper view</span>`;
    const buttons = DISPLAY_MODE_OPTIONS.map(({ key, label: buttonLabel }) => {
      return `<button type="button" class="display-mode__button" data-mode="${key}" aria-pressed="false">${escapeHtml(buttonLabel)}</button>`;
    }).join('');
    container.innerHTML = `${label}${buttons}`;
    Array.from(container.querySelectorAll('button[data-mode]')).forEach((button) => {
      button.addEventListener('click', () => {
        const mode = button.getAttribute('data-mode');
        if (!mode) return;
        setDisplayMode(mode);
      });
    });
    updateDisplayModeButtons();
  }

  function setDisplayMode(mode) {
    const normalized = normalizeDisplayMode(mode);
    if (normalized === state.displayMode) {
      return;
    }
    state.displayMode = normalized;
    saveDisplayMode(normalized);
    applyDisplayModeClass();
    updateDisplayModeButtons();
    updatePaperAria();
  }

  function applyDisplayModeClass() {
    const targetClass = DISPLAY_MODE_CLASSES[state.displayMode] || DISPLAY_MODE_CLASSES.full;
    const classList = document.body.classList;
    Object.values(DISPLAY_MODE_CLASSES).forEach((cls) => classList.remove(cls));
    classList.add(targetClass);
  }

  function updateDisplayModeButtons() {
    const container = elements.displayModeControls;
    if (!container) return;
    const activeMode = state.displayMode;
    Array.from(container.querySelectorAll('button[data-mode]')).forEach((button) => {
      const mode = button.getAttribute('data-mode');
      const isActive = mode === activeMode;
      button.classList.toggle('is-active', isActive);
      button.setAttribute('aria-pressed', String(isActive));
    });
  }

  function renderPreferencesPanel() {
    const favorites = state.preferences.favorite_authors || [];
    const keywords = state.preferences.keywords || [];

    if (elements.favoriteAuthorsView) {
      elements.favoriteAuthorsView.innerHTML = favorites.length
        ? favorites.map((item) => `<span class="chip">${escapeHtml(item)}</span>`).join('')
        : '<span class="preferences-empty">None</span>';
    }
    if (elements.keywordsView) {
      elements.keywordsView.innerHTML = keywords.length
        ? keywords.map((item) => `<span class="chip">${escapeHtml(item)}</span>`).join('')
        : '<span class="preferences-empty">None</span>';
    }

    if (state.isEditingPreferences) {
      if (elements.preferencesView) elements.preferencesView.hidden = true;
      if (elements.preferencesForm) elements.preferencesForm.hidden = false;
      updatePreferenceInputs();
    } else {
      if (elements.preferencesView) elements.preferencesView.hidden = false;
      if (elements.preferencesForm) elements.preferencesForm.hidden = true;
    }
  }

  function renderOverview(sourceData, articles) {
    const body = elements.overviewBody;
    if (!body) return 0;
    const summary = elements.overviewSummary;
    const total = articles.length;
    const sourceLabel = sourceData.label || state.source;
    const plural = total === 1 ? '' : 's';
    if (summary) {
      summary.textContent = total + ' paper' + plural + ' from ' + sourceLabel + '.';
    }
    body.innerHTML = articles.map(renderArticleCard).join('') || '<p class="empty-state">No papers available.</p>';
    return total;
  }

  function renderStats(sourceData) {
    const body = elements.statsBody;
    if (!body) return;
    const stats = sourceData.stats || {};
    const total = stats.total || 0;
    const uniqueAuthors = stats.unique_authors || 0;
    const totalAuthorships = stats.total_authorships || 0;
    const averageAuthors = (stats.average_authors || 0).toFixed(2);
    const topAuthors = (stats.top_authors || []).map(([name, count]) => `<li>${escapeHtml(name)} (${count})</li>`).join('') || '<li>None</li>';
    const topPhrases = (stats.top_phrases || []).map(([phrase, count]) => `<li>${escapeHtml(phrase)} (${count})</li>`).join('') || '<li>None</li>';
    const sectionCounts = Object.entries(stats.section_counts || {})
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([section, count]) => `<li>${escapeHtml(section)} (${count})</li>`)
      .join('') || '<li>None</li>';

    body.innerHTML = `
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Papers</h3>
          <p>Total papers: ${total}</p>
          <p>Avg authors per paper: ${averageAuthors}</p>
        </div>
        <div class="stat-card">
          <h3>Authors</h3>
          <p>Unique authors: ${uniqueAuthors}</p>
          <p>Total author mentions: ${totalAuthorships}</p>
        </div>
        <div class="stat-card">
          <h3>Top Authors</h3>
          <ul>${topAuthors}</ul>
        </div>
        <div class="stat-card">
          <h3>Popular Phrases</h3>
          <ul>${topPhrases}</ul>
        </div>
        <div class="stat-card">
          <h3>Section Breakdown</h3>
          <ul>${sectionCounts}</ul>
        </div>
      </div>
    `;
  }

  function renderFavorites(sourceData, articles) {
    const body = elements.favoritesBody;
    if (!body) return 0;
    const favorites = state.preferences.favorite_authors || [];
    const matches = filterByFavoriteAuthors(articles, favorites);
    body.innerHTML = buildWatcherSectionContent(favorites, matches, 'Add authors in the sidebar to highlight researchers you care about.');
    return matches.length;
  }

  function renderKeywords(sourceData, articles) {
    const body = elements.keywordsBody;
    if (!body) return 0;
    const keywords = state.preferences.keywords || [];
    const matches = filterByKeywords(articles, keywords);
    body.innerHTML = buildWatcherSectionContent(keywords, matches, 'Track important topics by adding keywords in the sidebar.');
    return matches.length;
  }

  function buildWatcherSectionContent(items, matches, emptyMessage) {
    const chips = (items || []).map((item) => `<span class="chip">${escapeHtml(item)}</span>`).join('');
    const summary = items.length
      ? `<div class="watcher-summary">Watching <strong>${items.length}</strong> entr${items.length === 1 ? 'y' : 'ies'}.<div class="chip-set">${chips}</div></div>`
      : `<div class="watcher-summary">${emptyMessage}</div>`;
    const articlesHtml = matches.length
      ? matches.map(renderArticleCard).join('')
      : '<p class="empty-state">No papers matched the current filters.</p>';
    return `${summary}${articlesHtml}`;
  }

  function renderCategories(sourceData, articles) {
    const body = elements.categoriesBody;
    if (!body) return [];
    const groups = buildSectionGrouping(articles);
    if (!groups.length) {
      body.innerHTML = '<p class="empty-state">No categories available for this source.</p>';
      return [];
    }
    const sectionsHtml = groups.map(({ sectionId, sectionLabel, count, subjects }) => {
      const subjectHtml = subjects.map(({ subjectId, subjectLabel, items }) => `
        <div class="subject-group" id="${subjectId}">
          <div class="subject-group__header">
            <h4>${escapeHtml(subjectLabel)}</h4>
            <span class="count-chip">${formatCount(items.length)}</span>
          </div>
          ${items.map(renderArticleCard).join('')}
        </div>
      `).join('');
      return `
        <div class="category-block" id="${sectionId}">
          <div class="category-block__header">
            <h3>${escapeHtml(sectionLabel)}</h3>
            <span class="count-chip">${formatCount(count)}</span>
          </div>
          <div class="subject-grid">
            ${subjectHtml}
          </div>
        </div>
      `;
    }).join('');
    body.innerHTML = sectionsHtml;
    return groups.map(({ sectionId, sectionLabel, count, subjects }) => ({
      id: sectionId,
      label: `${sectionLabel} (${count})`,
      children: subjects.map(({ subjectId, subjectLabel, items }) => ({
        id: subjectId,
        label: `${subjectLabel} (${items.length})`,
      })),
    }));
  }

  function renderNavigation(sourceData, overviewCount, favoriteCount, keywordCount, categoriesNavItems) {
    if (!elements.nav) return;
    const navItems = [
      { id: 'stats', label: 'Statistics' },
      { id: 'overview', label: `All Papers (${overviewCount})` },
      { id: 'favorite', label: `Favorite Authors (${favoriteCount})` },
      { id: 'keyword', label: `Watched Keywords (${keywordCount})` },
      { id: 'categories', label: 'Browse by Category', children: categoriesNavItems },
    ];
    elements.nav.innerHTML = buildNavList(navItems);
  }

  function buildNavList(items, level = 1) {
    if (!items || !items.length) return '';
    const listClass = `nav-list nav-level-${level}`;
    const inner = items.map((item) => {
      const children = buildNavList(item.children || [], level + 1);
      return `<li class="nav-item nav-level-${level}"><a href="#${item.id}">${escapeHtml(item.label)}</a>${children}</li>`;
    }).join('');
    return `<ul class="${listClass}">${inner}</ul>`;
  }

  function updateHeader(sourceData) {
    if (elements.headerSource) elements.headerSource.textContent = `Source: ${sourceData.label || state.source}`;
    if (elements.headerDate) elements.headerDate.textContent = `Date: ${sourceData.date || ''}`;
    if (elements.headerGenerated) elements.headerGenerated.textContent = `Generated at: ${generatedAt}`;
    if (elements.headerTotal) elements.headerTotal.textContent = `Total papers: ${(sourceData.stats && sourceData.stats.total) || 0}`;
  }

  function updateFooter(sourceData) {
    if (!elements.footerSource) return;
    elements.footerSource.textContent = sourceData.label || state.source;
    if (sourceData.url) {
      elements.footerSource.setAttribute('href', sourceData.url);
    }
  }

  function attachSectionHandlers() {
    const toggles = Array.from(document.querySelectorAll('.section-toggle'));
    toggles.forEach((toggle) => {
      toggle.onclick = () => {
        const targetId = toggle.getAttribute('data-target');
        if (!targetId) return;
        const section = document.getElementById(targetId);
        if (!section) return;
        const willExpand = section.classList.contains('is-collapsed');
        setSectionState(section, willExpand);
        if (willExpand) {
          state.activeSection = section.id;
          setActiveSection(section.id);
        }
      };
    });
    const navLinks = elements.nav ? Array.from(elements.nav.querySelectorAll('a[href^="#"]')) : [];
    navLinks.forEach((link) => {
      link.onclick = (event) => {
        const href = link.getAttribute('href');
        if (!href || !href.startsWith('#')) return;
        const targetId = href.slice(1);
        const targetElement = document.getElementById(targetId);
        if (!targetElement) return;
        const container = targetElement.classList.contains('content-section')
          ? targetElement
          : targetElement.closest('.content-section');
        if (!container) return;
        event.preventDefault();
        state.activeSection = container.id;
        setActiveSection(container.id, targetElement);
      };
    });
  }

  function setActiveSection(sectionId, focusTarget) {
    state.activeSection = sectionId || 'stats';
    const sections = Array.from(document.querySelectorAll('.content-section'));
    sections.forEach((section) => {
      const isActive = section.id === state.activeSection;
      section.classList.toggle('is-hidden', !isActive);
      if (section.dataset.collapsible === 'true') {
        setSectionState(section, isActive);
      } else {
        section.classList.toggle('is-collapsed', !isActive);
      }
    });
    const activeSection = document.getElementById(state.activeSection);
    if (activeSection) {
      const scrollTarget = focusTarget && activeSection.contains(focusTarget) ? focusTarget : activeSection;
      expandAncestors(scrollTarget);
      scrollTarget.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    if (elements.nav) {
      const navLinks = Array.from(elements.nav.querySelectorAll('a[href^="#"]'));
      navLinks.forEach((link) => {
        const href = link.getAttribute('href');
        const id = href ? href.slice(1) : '';
        link.classList.toggle('is-active', id === state.activeSection);
      });
    }
  }

  function updatePaperAria() {
    const cards = Array.from(document.querySelectorAll('.paper'));
    cards.forEach((card) => {
      const paperId = card.getAttribute('data-paper-id') || '';
      const isUserExpanded = paperId && state.expandedArticles.has(paperId);
      const isExpanded = state.displayMode === 'full' || Boolean(isUserExpanded);
      card.setAttribute('aria-expanded', String(isExpanded));
      card.classList.toggle('paper--expanded', Boolean(isUserExpanded));
    });
  }

  function handleQuickViewClick(event) {
    const button = event.target.closest('.js-view-abstract');
    if (!button) return;
    const articleId = button.getAttribute('data-article-id') || '';
    const details = buildModalDetails(articleId, button);
    if (!details.url && !details.title) return;
    event.preventDefault();
    event.stopPropagation();
    openAbstractModal(details, button);
  }

  function handlePaperClick(event) {
    const paper = event.target.closest('.paper');
    if (!paper) return;
    if (event.target.closest('a')) return;
    if (event.target.closest('.js-view-abstract')) return;
    togglePaperExpansion(paper);
  }

  function handlePaperKeydown(event) {
    if (event.key !== 'Enter' && event.key !== ' ') return;
    const paper = event.target.closest('.paper');
    if (!paper) return;
    if (event.key === ' ') {
      event.preventDefault();
    }
    togglePaperExpansion(paper);
  }

  function togglePaperExpansion(paper) {
    const paperId = paper.getAttribute('data-paper-id') || '';
    if (!paperId) return;
    if (state.expandedArticles.has(paperId)) {
      state.expandedArticles.delete(paperId);
    } else {
      state.expandedArticles.add(paperId);
    }
    updatePaperAria();
  }

  function attachModalHandlers() {
    if (modalHandlersBound) return;
    modalHandlersBound = true;
    if (elements.abstractModalClose) {
      elements.abstractModalClose.addEventListener('click', () => closeAbstractModal());
    }
    if (elements.abstractModal) {
      elements.abstractModal.addEventListener('click', (event) => {
        if (event.target && event.target.getAttribute('data-modal-dismiss') === 'true') {
          closeAbstractModal();
        }
      });
    }
  }

  function handleGlobalKeydown(event) {
    if (event.key === 'Escape' && isModalOpen()) {
      event.preventDefault();
      closeAbstractModal();
    }
  }

  function isModalOpen() {
    return Boolean(elements.abstractModal && elements.abstractModal.classList.contains('is-open'));
  }

  function openAbstractModal(details, trigger) {
    if (!elements.abstractModal) return;
    state.lastModalTrigger = trigger || null;
    const resolvedTitle = decodeHtml(details.title) || 'Preview abstract';
    const resolvedUrl = decodeHtml(details.url);
    const resolvedAuthors = decodeHtml(details.authors);
    const resolvedSubjects = decodeHtml(details.subjects);
    const resolvedAbstract = decodeHtml(details.abstract);
    const resolvedId = decodeHtml(details.arxivId);
    const resolvedPdf = decodeHtml(details.pdfUrl);
    elements.abstractModal.classList.add('is-open');
    elements.abstractModal.setAttribute('aria-hidden', 'false');
    document.body.classList.add('modal-open');
    if (elements.abstractModalClose) {
      elements.abstractModalClose.focus();
    }
    if (elements.abstractModalTitle) {
      elements.abstractModalTitle.textContent = resolvedTitle;
    }
    if (elements.abstractModalBody) {
      elements.abstractModalBody.scrollTop = 0;
    }
    if (elements.abstractModalId) {
      elements.abstractModalId.textContent = resolvedId ? `ID: ${resolvedId}` : '';
      elements.abstractModalId.hidden = !resolvedId;
    }
    if (elements.abstractModalAuthors) {
      elements.abstractModalAuthors.textContent = resolvedAuthors ? `Authors: ${resolvedAuthors}` : '';
      elements.abstractModalAuthors.hidden = !resolvedAuthors;
    }
    if (elements.abstractModalSubjects) {
      elements.abstractModalSubjects.textContent = resolvedSubjects ? `Subjects: ${resolvedSubjects}` : '';
      elements.abstractModalSubjects.hidden = !resolvedSubjects;
    }
    if (elements.abstractModalAbstract) {
      elements.abstractModalAbstract.textContent = resolvedAbstract || 'No abstract available.';
    }
    if (elements.abstractModalOriginal) {
      if (resolvedUrl) {
        elements.abstractModalOriginal.href = resolvedUrl;
        elements.abstractModalOriginal.hidden = false;
      } else {
        elements.abstractModalOriginal.href = '#';
        elements.abstractModalOriginal.hidden = true;
      }
    }
    if (elements.abstractModalPdf) {
      if (resolvedPdf) {
        elements.abstractModalPdf.href = resolvedPdf;
        elements.abstractModalPdf.hidden = false;
      } else {
        elements.abstractModalPdf.href = '#';
        elements.abstractModalPdf.hidden = true;
      }
    }
  }

  function closeAbstractModal() {
    if (!elements.abstractModal) return;
    elements.abstractModal.classList.remove('is-open');
    elements.abstractModal.setAttribute('aria-hidden', 'true');
    document.body.classList.remove('modal-open');
    if (state.lastModalTrigger && typeof state.lastModalTrigger.focus === 'function') {
      state.lastModalTrigger.focus();
    }
    state.lastModalTrigger = null;
  }

  function setSectionState(section, expanded) {
    if (expanded) {
      section.classList.add('is-expanded');
      section.classList.remove('is-collapsed');
    } else {
      section.classList.add('is-collapsed');
      section.classList.remove('is-expanded');
    }
    const toggle = section.querySelector('.section-toggle');
    if (toggle) {
      toggle.setAttribute('aria-expanded', String(expanded));
      toggle.textContent = expanded ? 'Hide section' : 'Show section';
    }
  }

  function expandAncestors(element) {
    if (!element) return;
    let parent = element.closest('[data-collapsible="true"]');
    while (parent) {
      setSectionState(parent, true);
      parent = parent.parentElement ? parent.parentElement.closest('[data-collapsible="true"]') : null;
    }
  }

  function renderArticleCard(article) {
    const articleId = String(article.arxiv_id || article.id || '');
    const title = escapeHtml(article.title);
    const authors = escapeHtml((article.authors || []).join(', '));
    const subjects = escapeHtml((article.subjects || []).join('; '));
    const abstract = escapeHtml(article.abstract);
    const absUrl = escapeHtml(article.abs_url);
    const pdfUrl = article.pdf_url ? escapeHtml(article.pdf_url) : '';
    const pdfLink = pdfUrl ? `<a href="${pdfUrl}" target="_blank" rel="noopener">PDF</a>` : '';
    const quickViewButton = `<button type="button" class="link-button quick-view-button js-view-abstract" data-abs-url="${absUrl}" data-article-title="${title}" data-article-authors="${authors}" data-article-subjects="${subjects}" data-article-abstract="${abstract}" data-article-id="${escapeHtml(article.arxiv_id)}" data-article-pdf="${pdfUrl}">Quick view</button>`;
    const linkItems = [`<a href="${absUrl}" target="_blank" rel="noopener">Abstract</a>`, pdfLink].filter(Boolean).join(' ');
    const isUserExpanded = state.expandedArticles.has(articleId);
    const ariaExpanded = state.displayMode === 'full' || isUserExpanded;
    const expandedClass = isUserExpanded ? ' paper--expanded' : '';
    return `
      <article class="paper${expandedClass}" data-paper-id="${escapeHtml(articleId)}" tabindex="0" aria-expanded="${ariaExpanded}">
        <h3><a href="${absUrl}" target="_blank" rel="noopener">${title}</a>${quickViewButton}</h3>
        <p class="meta">
          <span class="id">${escapeHtml(article.arxiv_id)}</span>
          <span class="authors">${authors}</span>
        </p>
        <p class="subjects">${subjects}</p>
        <p class="links">${linkItems}</p>
      </article>
    `;
  }

  function buildSectionGrouping(articles) {
    const sections = new Map();
    articles.forEach((article) => {
      const sectionKey = article.section_type || 'Other';
      const subjectKey = article.primary_subject || 'Other';
      if (!sections.has(sectionKey)) {
        sections.set(sectionKey, new Map());
      }
      const subjectMap = sections.get(sectionKey);
      if (!subjectMap.has(subjectKey)) {
        subjectMap.set(subjectKey, []);
      }
      subjectMap.get(subjectKey).push(article);
    });

    return Array.from(sections.entries())
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([sectionName, subjectMap]) => {
        const sectionId = `category-${slugify(sectionName)}`;
        const subjects = Array.from(subjectMap.entries())
          .sort(([a], [b]) => a.localeCompare(b))
          .map(([subjectName, items]) => ({
            subjectId: `${sectionId}-${slugify(subjectName, 'subject')}`,
            subjectLabel: subjectName,
            items,
          }));
        const count = subjects.reduce((sum, entry) => sum + entry.items.length, 0);
        return {
          sectionId,
          sectionLabel: sectionName,
          count,
          subjects,
        };
      });
  }

  function filterByFavoriteAuthors(articles, favoriteAuthors) {
    const favorites = (favoriteAuthors || []).map((name) => name.toLowerCase()).filter(Boolean);
    if (!favorites.length) return [];
    return articles.filter((article) => {
      const authorLower = article.authors.map((name) => name.toLowerCase());
      return favorites.some((fav) => authorLower.some((author) => author.includes(fav)));
    });
  }

  function filterByKeywords(articles, keywords) {
    const needles = (keywords || []).map((kw) => kw.toLowerCase()).filter(Boolean);
    if (!needles.length) return [];
    return articles.filter((article) => {
      const haystack = `${article.title} ${article.abstract}`.toLowerCase();
      return needles.some((needle) => haystack.includes(needle));
    });
  }

  function pruneExpandedArticles(articles) {
    const ids = new Set(
      (articles || []).map((article) => String(article.arxiv_id || article.id || '')).filter((value) => value),
    );
    Array.from(state.expandedArticles).forEach((storedId) => {
      if (!ids.has(storedId)) {
        state.expandedArticles.delete(storedId);
      }
    });
  }

  function updatePreferenceInputs() {
    if (elements.favoritesInput) {
      elements.favoritesInput.value = state.preferences.favorite_authors.join('\n');
    }
    if (elements.keywordsInput) {
      elements.keywordsInput.value = state.preferences.keywords.join('\n');
    }
  }

  function setStatus(message) {
    if (elements.preferencesStatus) {
      elements.preferencesStatus.textContent = state.isEditingPreferences ? message : '';
    }
    if (elements.preferencesStatusView) {
      elements.preferencesStatusView.textContent = state.isEditingPreferences ? '' : message;
    }
  }

  function escapeHtml(value) {
    return String(value || '')
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  function slugify(text, fallback = 'section') {
    const slug = String(text || '')
      .trim()
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '');
    return slug || fallback;
  }

  function formatCount(value) {
    const count = Number(value) || 0;
    return `${count} paper${count === 1 ? '' : 's'}`;
  }

  function normalizeDisplayMode(value) {
    if (typeof value !== 'string') {
      return 'full';
    }
    const normalized = value.trim().toLowerCase();
    return Object.prototype.hasOwnProperty.call(DISPLAY_MODE_CLASSES, normalized) ? normalized : 'full';
  }

  function normalizePreferences(raw) {
    const normalizeList = (value) => {
      if (Array.isArray(value)) {
        const cleaned = value.map((item) => String(item).trim()).filter((item) => item);
        return Array.from(new Set(cleaned));
      }
      if (typeof value === 'string') {
        const cleaned = value
          .split(/[\n,]/)
          .map((item) => item.trim())
          .filter((item) => item);
        return Array.from(new Set(cleaned));
      }
      return [];
    };
    return {
      favorite_authors: normalizeList(raw.favorite_authors),
      keywords: normalizeList(raw.keywords),
    };
  }

  function loadStoredDisplayMode() {
    try {
      const stored = localStorage.getItem(DISPLAY_MODE_STORAGE_KEY);
      return stored ? normalizeDisplayMode(stored) : '';
    } catch (_) {
      return '';
    }
  }

  function saveDisplayMode(mode) {
    try {
      localStorage.setItem(DISPLAY_MODE_STORAGE_KEY, normalizeDisplayMode(mode));
    } catch (_) {}
  }

  function loadStoredSource() {
    try {
      return localStorage.getItem(SOURCE_STORAGE_KEY) || '';
    } catch (_) {
      return '';
    }
  }

  function saveSource(value) {
    try {
      localStorage.setItem(SOURCE_STORAGE_KEY, value);
    } catch (_) {}
  }

  function loadStoredPreferences() {
    try {
      const raw = localStorage.getItem(PREF_STORAGE_KEY);
      return raw ? normalizePreferences(JSON.parse(raw)) : normalizePreferences(initialPreferences);
    } catch (_) {
      return normalizePreferences(initialPreferences);
    }
  }

  function savePreferences(prefs) {
    try {
      localStorage.setItem(PREF_STORAGE_KEY, JSON.stringify(prefs));
    } catch (_) {}
  }

  function decodeHtml(value) {
    if (!value) return '';
    const textarea = document.createElement('textarea');
    textarea.innerHTML = value;
    return textarea.value;
  }

  function buildModalDetails(articleId, button) {
    const sourceData = RAW_DATA.sources[state.source] || {};
    const articles = Array.isArray(sourceData.articles) ? sourceData.articles : [];
    const article = articleId ? articles.find((item) => {
      const id = String(item.arxiv_id || item.id || '');
      return id === articleId;
    }) : null;
    const dataset = button.dataset || {};
    const details = {
      title: article && article.title ? article.title : dataset.articleTitle || '',
      url: article && article.abs_url ? article.abs_url : dataset.absUrl || '',
      authors: Array.isArray(article && article.authors) ? article.authors.join(', ') : dataset.articleAuthors || '',
      subjects: Array.isArray(article && article.subjects) ? article.subjects.join('; ') : dataset.articleSubjects || '',
      abstract: article && article.abstract ? article.abstract : dataset.articleAbstract || '',
      arxivId: article && article.arxiv_id ? article.arxiv_id : dataset.articleId || '',
      pdfUrl: article && article.pdf_url ? article.pdf_url : dataset.articlePdf || '',
    };
    return details;
  }
})();

  </script>
</body>
</html>
